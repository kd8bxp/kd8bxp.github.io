<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../../img/favicon.ico">
        <title>Bluetooth Audio with Onion BLE - Random Wire!</title>
        <link href="../../../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../../../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../../../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="../../../..">Random Wire!</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li >
                                <a href="../../../..">Home</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Tutorials <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../../blink/blink/">Blink</a>
</li>
                                    
<li >
    <a href="../../../document/">Document Projects</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">HiCat Livera Docs</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../livera/">Documentation</a>
</li>
            
<li >
    <a href="../../../livera/api/">API Guide</a>
</li>
            
<li >
    <a href="../../../livera/robotAssemGuide/">Robot Assembily Guide</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Raspberry PI</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../RaspberryPi/1.54inTFTGameScreen/tutorial/">1.54" TFT Touch Screen</a>
</li>
            
<li >
    <a href="../../../RaspberryPi/OpenCV/opencv/">Raspberry PI Zero W OpenCV</a>
</li>
            
<li >
    <a href="../../../RaspberryPi/restrictedshell/">Restricted Shell</a>
</li>
            
<li >
    <a href="../../../RaspberryPi/jupyter/">Setup Jupyter Notebook</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">FPGA Boards</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../ArduinoMKRVidor4000_fpga_board/">Arduino MKR Vidor 4000</a>
</li>
            
<li >
    <a href="../../../mojov3fpga/">Mojo V3 FPGA</a>
</li>
    </ul>
  </li>
                                    
<li >
    <a href="../../../TI/resources/">TI Launchpad Resources</a>
</li>
                                    
<li >
    <a href="../../../ESP-MESH/ESP-MESH/">ESP-MESH Board</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">MQTT Services</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../MQTT-Services/brokers/">Brokers</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Tessel</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../Tessel/readme/">Resources</a>
</li>
    </ul>
  </li>
                                    
<li >
    <a href="../../../syncthing/">Syncthing</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Cozmo SDK</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../CozmoSDKDocs/CozmoInfo/">Cozmo Information</a>
</li>
            
<li >
    <a href="../../../CozmoSDKDocs/SDK/adb/">ADB</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Sipeed Maix Bit</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../SipeedMaixBit/info/">General Information</a>
</li>
            
<li >
    <a href="../../../SipeedMaixBit/M5StickV/">M5StickV</a>
</li>
            
<li >
    <a href="../../../SipeedMaixBit/Sipeed_Maixduino/">Sipeed Maixduino</a>
</li>
    </ul>
  </li>
                                    
<li >
    <a href="../../../azuresphere/">Azure Sphere General Information</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Projects <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#">Arduino</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../../projects/arduino/chatterbot/">Chatter Bot</a>
</li>
            
<li >
    <a href="../../../../projects/arduino/arduino-project-4x4-keypad-matrix-rotary-encoder/">4x4 Keypad Matrix</a>
</li>
            
<li >
    <a href="../../../../projects/arduino/arduino-project-arduino-vga-out/">Arduino VGA</a>
</li>
            
<li >
    <a href="../../../../projects/arduino/arduino-project-bmp180-digital-barometric-pressur/">BMP180 Sensor</a>
</li>
            
<li >
    <a href="../../../../projects/arduino/arduino-project-fs1000a-433mhz-transmitters/">FS1000a 433mhz Transmitters</a>
</li>
            
<li >
    <a href="../../../../projects/arduino/arduino-project-hc-05-bluetooth-device/">HC-05 Bluetooth</a>
</li>
            
<li >
    <a href="../../../../projects/arduino/arduino-project-magnetic-reed-switch-water-sensor/">Magnetic Reed Switch Water Sensor</a>
</li>
            
<li >
    <a href="../../../../projects/arduino/arduino-project-mifare-rfid-reader-rc522/">Mifare RFID reader RC522</a>
</li>
            
<li >
    <a href="../../../../projects/arduino/arduino-project-nokia-5110-lcd/">Nokia 5110 LCD</a>
</li>
            
<li >
    <a href="../../../../projects/arduino/arduino-project-pin-control-over-ethernet-oled-de/">Pin Control over Ethernet w/OLED</a>
</li>
            
<li >
    <a href="../../../../projects/arduino/arduino-project-skynet-im/">Skynet IM</a>
</li>
            
<li >
    <a href="../../../../projects/arduino/arduino-project-the-spo-512-speech-synthesizer/">SPO-512 Speech Synthesizer</a>
</li>
            
<li >
    <a href="../../../../projects/arduino/QVGA-DISPLAY/QVGA-Display2/">QVGA Display</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">ESP8266</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../../projects/esp8266/">Temp</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">ESP32</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../../projects/esp32/">Temp</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">TI LaunchPad</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../../projects/TILaunchPad/ti-multi-task/">TI Launchpad MS432 Multi-Task Demo</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Raspberry PI</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../../projects/RaspberryPI/services/">General Information</a>
</li>
            
<li >
    <a href="../../../../projects/RaspberryPI/">PIDuino Setup</a>
</li>
            
<li >
    <a href="../../../../projects/RaspberryPI/tunnelservices/">Raspberry PI Tunnel Services</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Other Projects</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../../projects/other/project-hot-wheels-10-525ghz-radar-gun/">Hot Wheels 10.524Ghz Radar Gun</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Robot Projects <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
  <li class="dropdown-submenu">
    <a href="#">Robot Chassis Kits</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../../projects/robot/chassis-kits/Actobotics/">Actobotics</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Hero Jr Robot</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../../projects/robot/herojr/">Hero Jr Project</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">Hero Jr Star Wars Day Dec 2015</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../../projects/robot/HeroJr-StarWarsDay/">General Info</a>
</li>
            
<li >
    <a href="../../../../projects/robot/HeroJr-StarWarsDay/Demo/">Midpointe Library Dec 12 Demo</a>
</li>
            
<li >
    <a href="../../../../projects/robot/HeroJr-StarWarsDay/Outline_Script_for_Star_Wars_Day_Hero_Jr/">Outline of Program</a>
</li>
            
<li >
    <a href="../../../../projects/robot/HeroJr-StarWarsDay/Star_Wars_Hero_Jr_Punch_List/">Punch List</a>
</li>
            
<li >
    <a href="../../../../projects/robot/HeroJr-StarWarsDay/pictures_from_Star_Wars_Day/">Pictures</a>
</li>
    </ul>
  </li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">2W & 4W Robots</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../robots/robotstart/">Getting Started</a>
</li>
            
<li >
    <a href="../../../../projects/robot/L298MotorDrive/">L298 Motor Driver</a>
</li>
            
<li >
    <a href="../../../../projects/robot/BittyBot/">BittyBot</a>
</li>
            
<li >
    <a href="../../../../projects/robot/BittyBot2Library/">BittyBot 2</a>
</li>
            
<li >
    <a href="../../../../projects/robot/CompactRoverLibrary/">Compact Rover</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">SunFounder Robots</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../../projects/robot/SunFounder_PISmartCar/">PISmartCar</a>
</li>
    </ul>
  </li>
                                    
<li >
    <a href="../../../../projects/robot/RobotNavigationusingRFID/">Robot Indoor Navigation using RFID</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Anki Vector</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../../projects/robot/Vector_Commands/">Command List</a>
</li>
    </ul>
  </li>
                                    
<li >
    <a href="../../../../projects/InternetControlledRobots/">Internet Controlled Robots</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Other Robot Projects (Not Mine)</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../../projects/robot/anki_vector_cozmo/">Anki Vector and Cozmo</a>
</li>
            
<li >
    <a href="../../../../projects/robot/Karotz/">Karotz</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Ham Radio <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../../../hamradio/hotspot/">MMDVM Hotspot Info</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Other <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../../../../comingsoon/">Sherlock Holmes</a>
</li>
                                    
<li >
    <a href="../../../../other/pp/">Pen and Paper RPG & Heroclix Games</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">Movies/TV Shows & OTR</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../../comingsoon/">X Minus One</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">The Orville</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../../other/theorville/comics/">Comics</a>
</li>
            
<li >
    <a href="../../../../comingsoon/">Planetary Union Central</a>
</li>
            
<li >
    <a href="../../../../other/theorville/wiki/">Fan Wiki</a>
</li>
    </ul>
  </li>
            
<li >
    <a href="../../../../comingsoon/">Forbidden Planet (C-57D)</a>
</li>
            
<li >
    <a href="../../../../comingsoon/">Batman (1966)</a>
</li>
            
<li >
    <a href="../../../../other/greenhornet/greenhornet/">Green Hornet</a>
</li>
    </ul>
  </li>
                                    
  <li class="dropdown-submenu">
    <a href="#">DC Comics</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../../comingsoon/">Comics</a>
</li>
            
  <li class="dropdown-submenu">
    <a href="#">TV Shows</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../../comingsoon/">The Flash</a>
</li>
            
<li >
    <a href="../../../../comingsoon/">Arrow</a>
</li>
            
<li >
    <a href="../../../../comingsoon/">Supergirl</a>
</li>
            
<li >
    <a href="../../../../comingsoon/">Legends of Tomorrow</a>
</li>
            
<li >
    <a href="../../../../comingsoon/">Batwoman</a>
</li>
            
<li >
    <a href="../../../../comingsoon/">Constantine</a>
</li>
    </ul>
  </li>
            
<li >
    <a href="../../../../comingsoon/">Movies</a>
</li>
            
<li >
    <a href="../../../../comingsoon/">Egyptian Gods</a>
</li>
    </ul>
  </li>
                                    
<li >
    <a href="../../../../comingsoon/">Lord of the Rings</a>
</li>
                                    
<li >
    <a href="../../../../comingsoon/">Noris Mythology</a>
</li>
                                    
<li >
    <a href="../../../../other/greek/">Greek Mythology</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#">More Stuff</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../../../other/stuff/">Stuff</a>
</li>
            
<li >
    <a href="../../../../other/CPU_Cryptocurrancy/">Crptocurrancy</a>
</li>
            
<li >
    <a href="../../../../other/InteractiveFiction/">Interactive Fiction</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li >
                                <a href="../../../../about/">About Me</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#bluetooth-audio-with-onion-ble">Bluetooth Audio with Onion BLE</a></li>
        <li class="main "><a href="#background-info">Background Info</a></li>
        <li class="main "><a href="#the-actual-process">The Actual Process</a></li>
            <li><a href="#step-1-hardware-and-omega-setup">Step 1: Hardware and Omega Setup</a></li>
            <li><a href="#step-2-installing-packages">Step 2: Installing Packages</a></li>
            <li><a href="#step-3-setting-up-the-pulseaudio-daemon">Step 3: Setting up the PulseAudio Daemon</a></li>
            <li><a href="#step-4-remote-bluetooth-device-setup">Step 4: Remote Bluetooth Device Setup</a></li>
            <li><a href="#step-5-audio-playback-with-pulseaudio">Step 5: Audio Playback with PulseAudio</a></li>
        <li class="main "><a href="#using-the-project">Using the Project</a></li>
            <li><a href="#going-further">Going Further</a></li>
            <li><a href="#related-tutorials">Related Tutorials</a></li>
        <li class="main "><a href="#acknowledgements">Acknowledgements</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="bluetooth-audio-with-onion-ble">Bluetooth Audio with Onion BLE</h1>
<p>In this project we will turning our Omega into an bluetooth audio sink. This tutorial will allow you to retrofit your old speakers into bluetooth controlled speakers. The main goal of this project is to expose the Onion community to the bluetooth capabilities on OpenWRT. </p>
<p><img alt="Imgur" src="http://i.imgur.com/4p9UyXy.jpg" /></p>
<p>In this tutorial, we will learn how to use the BlueZ package to establish a connection with a remote bluetooth device and the PulseAudio package to source the audio to a USB soundcard. </p>
<p>[[<em>TOC</em>]]</p>
<p>Tutorial Difficulty:</p>
<p><strong>Intermediate</strong></p>
<p>Time Required:</p>
<p><strong>25 minutes</strong></p>
<p>Required Materials:
* The Omega
* The Expansion Dock
* Onion BLE
* USB Hub
* USB Audio Soundcard
* Speakers or Headphones (Something to test the audio with)</p>
<p>Useful Experience:
* Using BlueZ
* Using PulseAudio</p>
<h1 id="background-info">Background Info</h1>
<p>In short, Bluetooth LE allows us to transfer information to devices at distances upto 100m apart from each other. The communication consists of two parts, the pairing process and the connection process. The former is to "introduce" the devices to each other and the latter is what allows data transfer. The applications for bluetooth are ubiquitous including remote Audio/Video Control, Audio Source/Sink, Serial Communications, File Transfer ... etc. The application is defined by the "profile" that is hosted by the device. In our case we are using the BLE as a Audio Source/Sink, so we will only concern ourselves with the 'A2DP' profile. For a more thorough introduction to Bluetooth, refer to the wikipedia <a href="https://en.wikipedia.org/wiki/Bluetooth">page</a>. </p>
<h1 id="the-actual-process">The Actual Process</h1>
<p>In a nutshell, we will be connecting our hardware, installing the necessary packages, connecting our bluetooth device(Android Smartphone) and setting up an audio playback. Let's get started!</p>
<h2 id="step-1-hardware-and-omega-setup">Step 1: Hardware and Omega Setup</h2>
<p>Connect your USB soundcard and Onion BLE to the USB Hub and connect the USB hub to the Omega's USB port. We have to use a USB hub, because the omega's expansion only has one USB port and we need to two. Also we will be programming the omega through a serial terminal and will connect the Omega to our computer using a MicroUSB cable. </p>
<p>Your hardware setup should look like this. Also, note that I have not connected the speakers to the soundcard. </p>
<p><img alt="Imgur" src="http://i.imgur.com/XHRB9TP.jpg" /></p>
<p>After you are done this, enter to the Omega's command line. In this tutorial, we will be using a serial terminal but you can connect as you see fit. Make sure you are running the latest version of the Omega's firmware(Ver 8 or later), if you need to upgrade you can use the following command. </p>
<pre><code>oupgrade
</code></pre>

<p>Warning! Make sure you have backed up important data on your Omega during this process.</p>
<h2 id="step-2-installing-packages">Step 2: Installing Packages</h2>
<p>Here is the list of packages we will be using:</p>
<ul>
<li>obluez-libs</li>
<li>obluez-utils</li>
<li>opulseaudio-daemon</li>
<li>pulseaudio-profiles</li>
<li>pulseaudio-tools</li>
<li>alsa-lib</li>
<li>alsa-utils</li>
</ul>
<p>Before we start installing any packages, we need to run the following command. </p>
<pre><code>opkg update
</code></pre>

<p>Then run the following command to install the packages:</p>
<pre><code>opkg install obluez-libs obluez-utils opulseaudio-daemon pulseaudio-profiles pulseaudio-tools alsa-lib alsa-utils
</code></pre>

<p>You will find that a lot of other dependencies will be installed as well. You should see a screen like this. Fear not if you have the chown/chmod errors, they will not affect us. </p>
<p><img alt="Imgur" src="http://i.imgur.com/kHnfydZ.png" /></p>
<h2 id="step-3-setting-up-the-pulseaudio-daemon">Step 3: Setting up the PulseAudio Daemon</h2>
<p>After installation, we need to startup the PulseAudio daemon so that it runs in the background. Credits to the PulseAudio tutorial on the OpenWRT wiki for this section. To do this simply enter the following commands.</p>
<pre><code>udevd --daemon  
</code></pre>

<pre><code>chmod 0777 /dev/snd/* 
</code></pre>

<pre><code>mkdir -p /var/lib/pulse 
</code></pre>

<pre><code>pulseaudio --system --disallow-exit --no-cpu-limit &amp; 
</code></pre>

<p>The last command tends to create an assortment of warnings and errors. PulseAudio is somewhat unpredictable in this regard. If you have trouble, we recommend rebooting and restarting the process. If your problems persists, make a post in the community blog. As long as PulseAudio daemonizes we are happy. We can check this by running the ps command. </p>
<pre><code>ps
</code></pre>

<p>As you can see, PulseAudio is running for us.</p>
<p><img alt="Imgur" src="http://i.imgur.com/6CiUsHx.png" /></p>
<p>Now we can setup our bluetooth devices.</p>
<h2 id="step-4-remote-bluetooth-device-setup">Step 4: Remote Bluetooth Device Setup</h2>
<p>The bluetooth device setup is relatively simple. To make sure your dongle is connected properly run the command.</p>
<pre><code>hciconfig -a 
</code></pre>

<p>and to turn on the dongle run the following commands.</p>
<pre><code>hciconfig hci0 up
</code></pre>

<pre><code>hciconfig hci0 sspmode enable
</code></pre>

<pre><code>hciconfig hci0 piscan
</code></pre>

<p>At this point your donlge should be blinking a blue light. </p>
<p><img alt="Imgur" src="http://i.imgur.com/HPjAxzw.png" /></p>
<p>Now to actually connect to a device we have to use bluetoothctl.</p>
<p>Enter the command:</p>
<pre><code>bluetoothctl
</code></pre>

<p>You will enter into the bluetoothctl menu and your dongle will be listed as a controller. Run the following commands to make the dongle discoverable/pairable and allow it to discover other devices.</p>
<pre><code>agent on
</code></pre>

<pre><code>discoverable on
</code></pre>

<pre><code>pairable on
</code></pre>

<pre><code>scan on
</code></pre>

<p>At this point make sure phone or other remote device's bluetooth is on and discoverable. Once your device is located, pair with it using the following command.</p>
<pre><code>pair XX:XX:XX:XX:XX:XX
</code></pre>

<p>At this point you will be prompted to enter a PIN on the command line which you will then have to re-enter on you remote device for verification. Once you are done this, you may or may not be connected to the remote device. After this you should, we need to trust the remote device so that the remote device can initiate the connection. To do this, enter the command:</p>
<pre><code>trust XX:XX:XX:XX:XX:XX
</code></pre>

<p><img alt="Imgur" src="http://i.imgur.com/ZEf0BHe.png" /></p>
<p>Try initiating the connection from your device and it should work. You should see a screen like so. The remote device should be registered as an input device. </p>
<p><img alt="Imgur" src="http://i.imgur.com/Tvnlb9B.png" /></p>
<p>You can now quit the bluetooth menu with the command:</p>
<pre><code>quit
</code></pre>

<p>Also, your phone should recognize the OnionBLE as a media audio device. </p>
<p><img alt="Imgur" src="http://i.imgur.com/w1pJRca.png" /></p>
<h2 id="step-5-audio-playback-with-pulseaudio">Step 5: Audio Playback with PulseAudio</h2>
<p>Now you can check to make sure your device is still connected by running this command.</p>
<pre><code>hcitool con
</code></pre>

<p>Your device should be listed, if you see nothing. Try initiating the connection again from the remote device. If that doesn't work go back to the previous step. </p>
<p>To get the audio to play, we will be using the pactl utility. </p>
<p>To see our audio sources run the command:</p>
<pre><code>pactl list sources
</code></pre>

<p><img alt="Imgur" src="http://i.imgur.com/tc80rPa.png" /></p>
<p>Your device should show up as a source. For me it is source # 2. </p>
<p>We should do the same for the audio sinks, to confirm that our USB sound card is listed as a sink.</p>
<pre><code>pactl list sinks
</code></pre>

<p><img alt="Imgur" src="http://i.imgur.com/aJEOfNI.png" /></p>
<p>Now for the moment we've all be waiting for. Connect your speakers or headphones, MAKE SURE THE VOLUME IS LOW. Run the command below, replacing the source/sink names as listed in the previous two commands. </p>
<pre><code>pactl load-module module-loopback source=bluez_source.XX_XX_XX_XX_XX_XX sink=&lt;Sink Name&gt; rate=44100 adjust_time=0
</code></pre>

<p>If you see a number in the command line, it means its working. You should be hearing music right now. We should mention that when testing with the iphone, we established connection however only heard noise. Perhaps someone within the community can figure out the compatibility issue. </p>
<p><img alt="Imgur" src="http://i.imgur.com/gIHJptC.png" /></p>
<p>You can control the volume using pactl.</p>
<pre><code>pactl set-sink-volume 1 -25%
</code></pre>

<h1 id="using-the-project">Using the Project</h1>
<p>The onion modified packages for pulseaudio and bluez5 are encouraged to be used for other projects as users see fit. We encourage users to use this project as a baseline for other bluetooth projects. This is our first bluetooth project and will likely be adding more in the near future.</p>
<h2 id="going-further">Going Further</h2>
<p>We encourage the Onion and OpenWRT community to experiment and release tutorials on their experience with Bluetooth. </p>
<p>We've included a short list of interesting topics:</p>
<ul>
<li>Audio Compatibility with Iphone</li>
<li>Automated Pairing/Connection Process(Perhaps a script to handle bluetoothctl and PulseAudio)</li>
<li>File Transfer using obex</li>
<li>Serial Communication rfcomm</li>
</ul>
<h2 id="related-tutorials">Related Tutorials</h2>
<p><a href="https://wiki.openwrt.org/doc/howto/bluetooth.audio">OpenWRT Bluetooth Audio</a></p>
<p><a href="https://wiki.openwrt.org/doc/howto/usb.bluetooth">OpenWRT USB Bluetooth</a></p>
<p><a href="https://wiki.openwrt.org/doc/howto/pulseaudio">OpenWRT pulseaudio</a></p>
<h1 id="acknowledgements">Acknowledgements</h1>
<p>Thanks to the OpenWRT community.</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../../../..",
                shortcuts = {"search": 83, "next": 78, "help": 191, "previous": 80};
        </script>
        <script src="../../../../js/base.js" defer></script>
        <script src="../../../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
